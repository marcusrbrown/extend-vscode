# Edge Cases Analysis for Kebab-Case Conversion

**Created**: 2025-08-16
**Purpose**: Identify and document edge cases that could impact kebab-case file conversion

## Critical Edge Cases Identified

### 1. Package.json Exports - HIGH RISK

**Current Exports Affected**:
```json
"./statusBar": {
  "types": "./out/types/statusBar/index.d.ts",
  "browser": "./out/web/statusBar/index.js",
  "default": "./out/node/statusBar/index.js"
},
"./treeView": {
  "types": "./out/types/treeView/index.d.ts",
  "browser": "./out/web/treeView/index.js",
  "default": "./out/node/treeView/index.js"
}
```

**Impact**: External consumers using `import {...} from 'extend-vscode/statusBar'` will break

**Mitigation Options**:
1. **Keep external paths unchanged** (Recommended)
2. **Add both old and new export paths for backward compatibility**
3. **Update exports and create breaking change** (Not recommended)

**Recommended Solution**: Update internal build paths but maintain external export names:
```json
"./statusBar": {
  "types": "./out/types/status-bar/index.d.ts",  // Internal path updated
  "browser": "./out/web/status-bar/index.js",    // Internal path updated
  "default": "./out/node/status-bar/index.js"    // Internal path updated
}
```

### 2. Build System Output Paths - MEDIUM RISK

**Current tsup.config.ts**:
- Entry point: `['src/extension.ts']` ✅ No change needed
- Output directories: Dynamic based on source structure

**Potential Issues**:
- TypeScript declaration files (.d.ts) paths
- Source map references
- Asset copying paths

**Mitigation**:
- Verify build output paths align with package.json exports
- Test both Node and Web builds after conversion
- Check generated type declaration files

### 3. Generated Files - LOW-MEDIUM RISK

**src/generated/meta.ts**:
- Generated by `vscode-ext-gen` tool
- Based on package.json, not file structure
- **Impact**: Should be unaffected by file renames

**Verification Required**:
- Run `npm run generate:meta` after conversion
- Verify no errors in generation process
- Check that generated constants remain unchanged

### 4. Type Declaration Files - LOW RISK

**Existing .d.ts files**:
- `types/import-meta.d.ts` ✅ No references to renamed files
- `types/mock-vscode.d.ts` ✅ No references to renamed files

**Impact**: No changes required

### 5. Test Configuration - LOW RISK

**Vitest Configuration**:
- `vitest.config.ts`: No specific file path references found
- `vitest.config.web.ts`: No specific file path references found
- Test files don't directly import renamed modules

**Impact**: Minimal, mostly import path updates in test files

### 6. External Tool Integration - MEDIUM RISK

**vscode-ext-gen Tool**:
- Generates `src/generated/meta.ts`
- Based on package.json contributions, not file structure
- **Expected Impact**: None

**ESLint Configuration**:
- `eslint.config.ts`: No specific file path rules found
- **Expected Impact**: None

**TypeScript Configuration**:
- `tsconfig.json`: Uses glob patterns, not specific paths
- **Expected Impact**: None

## Backward Compatibility Considerations

### External Package Consumers

**Current Supported Imports**:
```typescript
// These must continue to work:
import {setupStatusBar} from 'extend-vscode/statusBar';
import {setupTreeView} from 'extend-vscode/treeView';
import {ExtensionController} from 'extend-vscode';  // From main export
```

**Strategy**: Maintain external API surface, change only internal structure

### Version Compatibility

**Semver Impact**:
- **Major Version**: If external exports change
- **Minor Version**: If only internal structure changes (Recommended)
- **Patch Version**: Not appropriate for file structure changes

**Recommendation**: Treat as minor version bump if external API preserved

## Implementation Edge Case Handling

### Directory Rename Sequence

**Problem**: Directory renames can cause temporary broken states

**Solution**: Atomic operations using git commands:
```bash
# Create new directory structure first
mkdir -p src/status-bar src/tree-view

# Copy files to new locations
cp -r src/statusBar/* src/status-bar/
cp -r src/treeView/* src/tree-view/

# Update imports
# ... (import update scripts)

# Remove old directories
rm -rf src/statusBar src/treeView
```

### File System Case Sensitivity

**Problem**: macOS/Windows case-insensitive file systems may cause issues

**Solution**:
- Use `git mv` commands for renames to preserve git history
- Verify changes on case-sensitive systems (Linux/CI)

### IDE Integration

**Problem**: VS Code may cache old import paths

**Solution**:
- Restart TypeScript language server after conversion
- Clear VS Code workspace cache if needed
- Use "Reload Window" command in development

## Validation Requirements

### Pre-Conversion Validation

```bash
# 1. Verify package.json exports are understood
npm pack --dry-run

# 2. Verify build system works
npm run build

# 3. Verify generated files work
npm run generate:meta

# 4. Verify tests pass
npm test
```

### Post-Conversion Validation

```bash
# 1. Verify package exports still work
npm pack --dry-run

# 2. Verify both build targets work
npm run build
ls -la out/node/status-bar out/web/status-bar

# 3. Verify external imports work
node -e "require('./out/node/index.js')"

# 4. Verify TypeScript declarations match
npm run type-check

# 5. Test external consumer scenario
cd /tmp && npm init -y && npm install path/to/extend-vscode
```

## Risk Assessment Matrix

| Edge Case | Risk Level | Impact | Mitigation Effort |
|-----------|------------|--------|------------------|
| Package.json exports | High | Breaking changes for consumers | High - Need dual exports |
| Build output paths | Medium | Build failures | Medium - Update configs |
| Generated files | Low-Medium | Tool failures | Low - Regenerate |
| Type declarations | Low | TypeScript errors | Low - No changes needed |
| Test configuration | Low | Test failures | Low - Update imports |
| External tools | Medium | Generation failures | Low - Verify tools work |

## Contingency Plans

### Package Export Strategy

**Option A - Conservative (Recommended)**:
- Keep external export names unchanged (`/statusBar`, `/treeView`)
- Update only internal build paths
- Zero breaking changes for consumers

**Option B - Progressive**:
- Add new kebab-case exports alongside old ones
- Deprecate old exports with console warnings
- Remove old exports in next major version

**Option C - Breaking Change**:
- Update all exports to kebab-case immediately
- Require major version bump
- Document migration guide for consumers

## Final Recommendations

1. **Use Conservative Package Export Strategy** (Option A)
2. **Test build system thoroughly** after directory renames
3. **Verify generated files** work with new structure
4. **Use atomic git operations** to minimize broken states
5. **Create comprehensive validation script** covering all edge cases
6. **Document any breaking changes** clearly in changelog
